# オンボーディングv2 — Step 2: 計画（コードは書かないで）

## 目的
Step 1の調査結果を踏まえ、オンボーディングv2の実装計画を立てる。
**このステップではコードを一切書かないでください。計画のみです。**

## 仕様書を読む
まず `docs/prompt-onboarding-v2.md` を読み込んでください。これが完全仕様書です。

## 計画として出力してほしいこと

### 1. ファイル変更一覧
変更・新規作成するファイルを全てリストアップ。各ファイルについて：
- ファイルパス
- 変更種別（新規/全面書き換え/部分修正）
- 変更概要（1-2行）

### 2. 状態管理設計
- OnboardingDataV2 の完全な型定義
- useState で管理する state の一覧
- 画面遷移ロジック（条件分岐含む）
- プログレスバーの進捗計算ロジック

### 3. コンポーネント分割計画
1075行の巨大ファイルを避けるため、以下に分割する方針を計画：
- 共通UIコンポーネント（YesNoButtons, ChipSelector, StepHeader 等）
- 各Phase用コンポーネント
- メインオーケストレーター

### 4. データ保存計画
- Supabase保存: どのテーブルにどのフィールドを保存するか
- ローカル保存: setLocalChildProfile への引数
- 初期ドメインレベル推定: domainAnswers → DDA初期値への変換

### 5. 影響範囲
- middleware.ts のリダイレクトロジックに影響はあるか
- ホーム画面 (page.tsx) の useChildProfile に影響はあるか
- 既存の型定義 (types/index.ts) に変更が必要か

### 6. リスクと対策
- 壊れそうな箇所とその回避策
- テストすべきフロー（最短ルート、最長ルート、条件分岐等）

## 注意
- 計画は具体的に。「適切に処理する」のような曖昧な表現は禁止
- 既存の動作を壊さないことを最優先にする
- 計画に対して私がOKを出してからStep 3に進む

**計画が完成するまでコードは書かないでください。**
